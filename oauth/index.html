<!-- The top of file index.html -->
<html lang="en">
  <head>
    <meta name="google-signin-scope" content="profile email https://www.googleapis.com/auth/business.manage">
    <meta name="google-signin-client_id" content="client_IDをここに入れる">
    <script src="https://apis.google.com/js/platform.js" async defer></script>
  </head>
  <body>
     
    <!---redirect button--->
    <div class="g-signin2" 
    data-onsuccess="onSignIn" 
    data-scope="https://www.googleapis.com/auth/plus.login"
    data-theme="dark"></div>
    <script>
    function onSignIn(googleUser) {
        // トークンの取得（サーバーにはこちらを送信）
        var id_token = googleUser.getAuthResponse().id_token;

        // 接続を解除して、2回目以降の自動ログインを防止
        var auth2 = gapi.auth2.getAuthInstance();
        auth2.disconnect();

        // 5.サーバへ送信
        var xhr = new XMLHttpRequest();

        // open()で指定するのは、サーバ側のURL
        xhr.open('POST', 'http://localhost:8080/oauth/server-side.php');
        xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
        // 処理が終わった後に呼ばれるコールバック
        xhr.onload = function() {
        if(xhr.readyState == 4 && xhr.status == 200){
            // ログイン完了後にリダイレクト
            window.location.href = 'http://localhost:8080/oauth/hoge.html';
        }
        else{
            console.log('エラー');
        }
        };
        xhr.send('idtoken=' + id_token);
        }
    </script>
  </body>
</html>
